.\" t -*- coding: UTF-8 -*-
.\" Manual-Seite fÃ¼r Â²DPROGÂ²
.\" Schreiben Sie an geraldschade@gmx.de, wenn Sie Fehler oder MÃ¤ngel entdeckt haben
.pc
.TH man 1 "13.08.17" "Version 0.45321" "Manual-Seite fÃ¼r Â²DPROGÂ²"
.SH NAME
\fBÂ²DPROGÂ² \- FaxServer-FunktionalitÃ¤t\fR: veranlasst automatischen Faxversand von Dateien, Benennung empfangener Faxe und Protokollierung aller Faxe in einer Datenbank 
.br
(manpage available in english: 'man Â²DPROGÂ²' or 'man -Len Â²DPROGÂ²')
.SH SYNOPSIS
\fBÂ²DPROGÂ² [-<kurzopt>|--<langopt> [<ergÃ¤nzung>]] ...\fR
.SH KURZBESCHREIBUNG
\fBÂ²DPROGÂ²\fR bietet quasi die FunktionalitÃ¤t eines Faxservers, welcher fÃ¼r manche auch hinter einer schnellen Datenleitung sinnvoll sein kann.
.br
\fBÂ²DPROGÂ²\fR ist ein Befehlszeilenprogramm, mit dem Dateien in einem bestimmten Verzeichnis automatisch an \fBhylafax\fR (falls ein linux-kompatibles Fax-Modem angeschlossen ist) und/oder \fBcapisuite\fR (falls eine Fritzcard 2.0 oder 2.1 angeschlossen ist) weiterleitet werden, wenn die Faxnummer im Dateinamen richtig eingetragen ist,
weiterhin die versandten Faxe in einer MariaDB-Datenbank abspeichert. 
.br
AuÃŸerdem kÃ¶nnen von \fBhylafax\fR/\fBcapisuite\fR empfangene Faxe automatisch nach dem Sender anhand dessen Faxnummer benannt und abgespeichert werden.
.br
Die Netzwerkintegration (z.B. auch in ein Windows-Netzwerk mit nur einem Linuxrechner) geschieht durch automatischen Eintrag der fÃ¼r Â²DPROGÂ² relevanten Verzeichnisse in einen Samba-Server. Sie kÃ¶nnte ergÃ¤nzt werden durch eine Maske fÃ¼r die mariadb-Datenbank.
.SH INSTALLATION
.br
ZunÃ¤chst lesen Sie bitte die untenstehenden Kapitel 'Funktionsweise','Voraussetzungen','Automatisch installierte Programmpakete' und 'Auswirkungen des Programmablaufs'.
.br
AnschlieÃŸend verbinden Sie den Rechner falls nÃ¶tig mit dem Internet und rufen Sie auf (z.B. durch Kopieren der Zeile in die Zwischenablage und EinfÃ¼gen in einem Terminal):
.br
\fBN=Â²DPROGÂ²;P=${N}_inst.sh;cd ~;wget https://raw.githubusercontent.com/Â²gitvÂ²/$N/master/install.sh -O$P&&sh $P\fR
.br
Zuletzt rufen Sie auf:
.br
 \fBÂ²DPROGÂ²\fR
.br
und beantworten einige Rueckfragen des Programms.
.br
Der erste Programmaufruf und die erste Faxverarbeitung eines gesandten/empfangenen Faxes mit Hylafax/Capsiuite kÃ¶nnen jeweils etwas dauern und ein paar zusÃ¤tzliche Eingaben erfordern.
.SH GEBRAUCH
Im Idealfall sollte sich das Programm nach einmaligem Aufruf (s.o.) so eingerichtet haben, dass es von selbst weiter lÃ¤uft.
.br
Es existiert dann ein Verzeichnis z.B. '\fBzufaxen\fR', in das z.B. Benutzer im Netzwerk (z.B. Ã¼ber die o.g. Samba-Freigabe) zu faxende Dateien stellen kÃ¶nnen wie z.B. 
.br
"\fBArztbericht zu Franz Krank an Dr. Gesund und Franz Krank an Fax 099 987654321 und 088 887654321.doc\fR" (es kÃ¶nnte auch z.B. eine *.xls, eine *.jpg, eine *.tif, eine *.txt oder eine *.pdf-Datei sein; die Passage 'an Dr. Gesund und Franz Krank ' ist optional fÃ¼r die spÃ¤tere Zordnung der Faxnummer(n) in der Datenbank, sie darf auch fehlen; auf der anderen Seite darf fÃ¼r den Fall, dass das Programm die letzten (1-)3 Faxe zu einem Adressaten eindeutig einer Faxnummer zuordnen kann, letztere auch fehlen).
.br
Wenn \fBÂ²DPROGÂ²\fR beim nÃ¤chsten Mal automatisch aufgerufen wird (standardmÃ¤ÃŸig alle 2 Minuten), wird die o.g. Beispieldatei zunÃ¤chst kopiert und umbenannt in 
.br
"\fBArztbericht zu Franz Krank an Dr. Gesund an Fax 099 987654321.doc\fR" und 
.br
"\fBArztbericht zu Franz Krank an Franz Krank an Fax 088 887654321.doc\fR" und in die PDF-Dateien 
.br
"\fBArztbericht zu Franz Krank an Dr. Gesund an Fax 099 987654321.pdf\fR" und 
.br
"\fBArztbericht zu Franz Krank an Franz Krank an Fax 088 887654321.pdf\fR" umgewandelt.
.br
Diese werden dann automatisch an \fBhylafax\fR oder \fBCapisuite\fR weitergeleitet und von dort aus verschickt.
.br
Gleichzeitig werden sie aus '\fBzufaxen\fR' in das Warteverzeichnis, z.B. '\fBwarteauffax\fR' verschoben und in die Spooltabelle \fBspooltab\fR eingetragen.
.br
Faxe, die durch einen Benutzer in '\fBzufaxen/2200\fR' bereitgestellt werden, werden ab 22:00 Uhr bearbeitet, wenn autofax lÃ¤uft.
.br
Bei jedem Aufruf Ã¼berprÃ¼ft Â²DPROGÂ² den Status von \fBhylafax\fR und/oder \fBCapisuite\fR. Der Abschluss eines Faxvorgangs dort hat zur Folge, dass Â²DPROGÂ² die Quelldateien (also hier die o.g. .doc- und .pdf-Dateien) aus dem Warteverzeichnis in ein oder mehrere alternative Archivverzeichnisse oder ein Verzeichnis fÃ¼r gescheiteterte Faxe ablegt und den Datenbankeintrag von '\fBspooltab\fR' in die Archivtabelle '\fBouta\fR' verschiebt.
.br
Weiterhin werden Ã¼ber \fBhylafax\fR oder \fBCapisuite\fR angekommene Faxe in ein Empfangsverzeichnis kopiert und ggf. nach dem Sender benannt. Hierzu werden, falls angegeben, konfigurierbare SQL-Befehle verwendet, die in frei festlegbarer Zahl der Reihe nach so lange aufgerufen werden, bis einer einen Datensatz zu der Faxnummer findet.
.br
Der Benutzer kÃ¶nnte also je nach Betriebssystem, ZugriffsmÃ¶glichkeit und PrÃ¤ferenz in den genannten Verzeichnissen, in den Datenbanktabellen oder durch Aufruf von z.B. '\fBÂ²DPROGÂ²\fB', '\fBÂ²DPROGÂ² -lista\fR', '\fBÂ²DPROGÂ² -listf\fR' oder '\fBÂ²DPROGÂ² -listi\fR' den Stand des Faxens Ã¼berprÃ¼fen. 

.SH OPTIONEN 
Mit '\fBÂ²DPROGÂ² -?\fR' oder '\fBÂ²DPROGÂ² -h\fR' werden die wichtigen und mit '\fBÂ²DPROGÂ² -lh\fR' alle Befehlszeilenoptionen sichtbar. Einige Optionen (z.B. SQL-Befehle) kÃ¶nnen nicht Ã¼ber die Befehlszeile, sondern nur Ã¼ber die Konfigurationsdatei eingegeben werden, die wiederum direkt editiert oder auch Ã¼ber '\fBÂ²DPROGÂ² -rf\fR' interaktiv gepflegt werden kann.
.br
\fBGebrauch: \fBautofax [-<opt>|--<longopt> [<content>]] ...\fR
.br
\fBFaxt Dateien aus Verzeichns <pfad>, die 'an Fax <faxnr>' enthalten und durch soffice in pdf konvertierbar sind 
.br
und traegt sie in MariaDB-Datenbank '\fBautofax\fB' (Tabellen: `\fBouta\fB`,`\fBspool\fB`) ein.\fR
.br
\fBOptionen, die nicht gespeichert werden: \fR
.br
\fB -w, --wortreich\fR: Bildschirmausgabe gespraechiger
.br
\fB -l, --log\fR: protokolliert ausfuehrlich in Datei '\fB/var/log/autofax.log\fR' (sonst knapper)
.br
\fB -ldn, --logdateineu\fR: logdatei vorher loeschen
.br
\fB -kd, --konfdatei <string>\fR: verwendet Konfigurationsdatei <string> anstatt '\fB\fR'
.br
\fB -sqlw, --sql-wortreich\fR: Bildschirmausgabe mit SQL-Befehlen
.br
\fB -rf, --rueckfragen\fR: alle Parameter werden abgefragt (darunter einige hier nicht gezeigten)
.br
\fB -krf, --keinerueckfragen\fR: keine Rueckfragen, z.B. fÃ¼r Aufruf aus cron
.br
\fB -loef, --loeschefax\fR: ein Fax nach Rueckfrage loeschen
.br
\fB -loew, --loeschewaise\fR: Eintraege aus `\fBspool\fR` loeschen, zu denen keine Datei im Wartevz.und kein Capi- oder Hylafax nachweisbar ist
.br
\fB -loea, --loescheallew\fR: alle wartenden Faxe und zugehoerige Eintraege aus `\fBspool\fR` loeschen
.br
\fB -erneut, --erneutempf\fR: empfangenes Fax erneut bereitstellen
.br
\fB -uml, --umleiten\fR: ausgehendes Fax vorzeitig auf zweitem Weg schicken
.br
\fB -kez, --korrerfolgszeichen\fR: in der Datenbanktabelle `\fBouta\fR` wird das Erfolgszeichen korrigiert
.br
\fB -bvz, --bereinigevz\fR: Dateien aus Wartevz.,Gescheitertenvz.u.Gefaxtvz.gegen `\fBouta\fR` pruefen und ggf. aufraeumen
.br
\fB -st, --stop\fR: autofaxanhalten
.br
\fB -lista, --listausg\fR: listet Datensaetze aus `\fBouta\fR` mit Erfolgskennzeichen auf
.br
\fB -listf, --listfehlgeschl\fR: listet Datensaetze aus `\fBouta\fR` ohne Erfolgskennzeichen auf
.br
\fB -liste, --listeing\fR: listet Datensaetze aus `\fBinca\fR` auf
.br
\fB -listw, --listwartende\fR: listet wartende Faxe auf
.br
\fB -s, --suche <string>\fR: Suche in verarbeiteten Faxen nach <string>: \fB\fR '\fB\fR'
.br
\fB -n, --dszahl <zahl>\fR: Zahl der aufzulistenden Datensaetze = <zahl> statt '\fB30\fR'
.br
\fB -info, --version\fR: Zeigt die Programmversion an
.br
\fB -vi, --vi\fR: Konfigurations- u.Logdatei bearbeiten/sehen (beenden mit ':qa')
.br
\fB -vc, --vc\fR: Capisuite-Konfigurationsdateien bearbeiten (beenden mit ':qa')
.br
\fB -vh, --vh\fR: Hylafax-Modem-Konfigurationsdatei bearbeiten (beenden mit ':qa')
.br
\fB -vs, --vs\fR: Quelldateien bearbeiten (beenden mit ':qa')
.br
\fB -h, --hilfe\fR: ErklÃ¤rung hÃ¤ufiger Optionen
.br
\fB -lh, --langhilfe\fR: ErklÃ¤rung aller Optionen
.br
\fBOptionen z.Speich. i.Konfigur'datei (vorausg. '1'=doch nicht speichern, 'no'=Gegenteil, z.B. '-noocra','-1noocri'):\fR
.br
\fB -sp, --sprache <string>\fR: Language/Sprache/Lingue/Lingua [\fBd\fReutsch,\fBe\fRnglisch] '\fBd\fR'
.br
\fB -lvz, --logvz <pfad>\fR: waehlt als Logverzeichnis <pfad>, derzeit '\fB/var/log\fR'
.br
\fB -ld, --logdname <string>\fR: logdatei <string> (im Pfad '\fB/var/log\fR') wird verwendet anstatt '\fBautofax.log\fR'
.br
\fB -zvz, --zufaxenvz <pfad>\fR: faxt die Dateien aus <pfad> anstatt '\fB/var/autofax/zufaxen\fR'
.br
\fB -wvz, --wartevz <pfad>\fR: Dateien warten in <pfad> anstatt '\fB/var/autofax/warteauffax\fR'
.br
\fB -ngvz, --nichtgefaxtvz <pfad>\fR: Gescheiterte Faxe werden hier gesammelt anstatt in '\fB/var/autofax/nichtgefaxt\fR'
.br
\fB -evz, --empfvz <pfad>\fR: Empfangsverzeichnis fuer Faxempfang '\fB/var/autofax/empfvz\fR'
.br
\fB -cm, --cronminuten <zahl>\fR: alle wieviel Minuten soll \fBautofax\fR ueber crontab aufgerufen werden (0=gar nicht), anstatt  '\fB2\fR'
.br
\fB -capi, --obcapi\fR: Capisuite verwenden\fB oder nicht\fR
.br
\fB -hyla, --obhyla\fR: Hylafax verwenden\fB oder nicht\fR
.br
\fB -cz, --capizuerst\fR: versuche faxe zuerst ueber Capisuite wegzuschicken\fB oder nicht\fR
.br
\fB -hz, --hylazuerst\fR: versuche faxe zuerst ueber hylafax wegzuschicken\fB oder nicht\fR
.br
\fB -mod, --hmodem <string>\fR: Fuer Hylafax verwendetes Modem, anstatt  '\fB\fR'
.br
\fB -mc, --maxcapiv <zahl>\fR: nach <zahl> Versuchen Capisuite wird Hylafax versucht, anstatt nach '\fB3\fR'
.br
\fB -mh, --maxhylav <zahl>\fR: nach <zahl> Versuchen Hylafax wird Capisuite versucht, anstatt nach '\fB3\fR'
.br
\fB -cuser, --cuser <string>\fR: verwendet fuer Capisuite und/oder Samba den Linux-Benutzer <string> anstatt '\fB\fR'
.br
\fB -ckzl, --cklingelzahl <zahl>\fR: Zahl der Klingeltoene, bis Capisuite den Anruf annimmt, anstatt '\fB1\fR'
.br
\fB -hkzl, --hklingelzahl <zahl>\fR: Zahl der Klingeltoene, bis Hylafax den Anruf annimmt, anstatt '\fB2\fR'
.br
\fB -hmw, --hmaxwahlvers <zahl>\fR: Zahl der Wahlversuche in Hylafax, anstatt  '\fB11\fR'
.br
\fB -gz, --gleichziel\fR: Faxe werden auch ohne Faxerfolg ins Zielverzeichnis kopiert\fB oder nicht\fR
.br
\fB -ocre, --ocre\fR: Text aus empfangenen Faxen wird ermittelt\fB oder nicht\fR
.br
\fB -ocra, --ocra\fR: Text aus gesandten Bildern wird ermittelt\fB oder nicht\fR
.br
\fB -afs, --anfaxstr <string>\fR: faxnr wird hinter <string> erwartet statt hinter '\fBan Fax\fR'
.br
\fB -acfs, --ancfaxstr <string>\fR: faxnr fuer primaer Capisuite wird hinter <string> erwartet statt hinter '\fBan cFax\fR'
.br
\fB -ahfs, --anhfaxstr <string>\fR: faxnr fuer primaer hylafax wird hinter <string> erwartet statt hinter '\fBan hFax\fR'
.br
\fB -as, --anstr <string>\fR: Adressatenname wird hinter <string> erwartet statt hinter '\fB an \fR'
.br
\fB -us, --undstr <string>\fR: Trennstring <string> fuer mehrere Adressaten/Telefonnummern statt '\fBund\fR'
.br
\fB -host, --host <string>\fR: verwendet die Datenbank auf Host <string> anstatt auf '\fBlocalhost\fR'
.br
\fB -muser, --muser <string>\fR: verwendet fuer MySQL/MariaDB den Benutzer <string> anstatt '\fBuser\fR'
.br
\fB -mpwd, --mpwd <string>\fR: verwendet fuer MySQL/MariaDB das Passwort <string>
.br
\fB -db, --datenbank <string>\fR: verwendet die Datenbank <string> anstatt '\fBautofax\fR'
.br
\fB -fd, --finde <zahl>\fR: Version 1,2 oder 3 -Dateisuche (variable Performanceunterschiede) anstatt '\fB3\fR'
.br
\fB -cm, --cronminuten <zahl>\fR: alle wieviel Minuten soll \fBautofax\fR ueber crontab aufgerufen werden (0=gar nicht), anstatt  '\fB2\fR'
static_cast<unsigned char>(tolower(static_cast<char>('Ã„')) ) = ãÃ¤UÃŸERST.SH FUNKTIONSWEISE
.LP
1) Die aktuelle Hardware wird Ã¼berprÃ¼ft:
.br
a) mit dem Befehl '\fBlspci | grep -i isdn\fR' bezÃ¼glich einer ISDN-Karte
.br
b) mit dem Befehl '\fBstty -F\fR' bezÃ¼glich eines Fax-Modems.
.LP
2) Die Fax-Konfigurationsdatei \fBfax.conf\fR der Capisuite wird eingelesen, falls es sie gibt
.LP
3) Weitere Vorgaben aus dem Programmcode werden zugewiesen, die durch die Â²DPROGÂ²-Konfigurationsdatei (siehe 4), Kommandozeilenargumente oder Antworten auf RÃ¼ckfragen (siehe 5) Ã¼berdeckt werden kÃ¶nnen.
.LP
4) Vorgaben werden geladen aus der Konfigurationsdatei, falls existent (standardmÃ¤ÃŸig \fBÂ²DPROGÂ².conf\fR im selben Verzeichnis wie \fBÂ²DPROGÂ²\fR, standardmÃ¤ÃŸig \fB/usr/local/sbin/Â²DPROGÂ²\fR)) 
.LP
5) RÃ¼ckfragen werden gestellt, falls in der Konfigurationsdatei Werte fehlen oder falls eine Kommandozeilenoption InteraktivitÃ¤t verlangt.
.LP
6) Das Verzeichnis von \fBhylafax\fR wird ermittelt (\fB/var/spool/hylafax\fR oder \fB/var/spool/fax\fR), falls hylafax installiert ist.
.LP
7) Von Benutzern verwendete Verzeichnisse fÃ¼r zu verschickende, wartende, versandte und gescheiterte und empfangene Fax-Dateien werden Ã¼berprÃ¼ft und ggf. erstellt. Dabei kÃ¶nnen in der Konfiguration angegebene Dateinamensmuster berÃ¼cksichtigt werden, um erfolgreich versandte Faxe je nach Dateinamen in verschiedenen Verzeichnissen zu speichern.
.LP
8) Das Programm trÃ¤gt sich ggf. in \fBcrontab\fR (des Benutzers root) ein, um auf Wunsch in (einstellbaren) AbstÃ¤nden aufgerufen zu werden. Um dies zu verhindern, kann entweder '\fBcronminut\fR' auf \fB0\fR eingestellt werden oder die bereits erstellten Â²DPROGÂ²-EintrÃ¤ge mit \fBcrontab -e\fR mit einem vorangestellten '\fB#\fR' auskommentiert werden.
.LP
9) Das Programm Ã¼berprÃ¼ft, ob alle benutzerreleventen Verzeichnisse (s. 7) von Sambafreigaben in \fB/etc/samba/smb.conf\fR erfasst werden, solche werden nÃ¶tigenfalls ergÃ¤nzt.
.LP
10) Der Betrieb von MariaDB wird Ã¼berprÃ¼ft, ggf. wird es (installiert und) in Betrieb gesetzt, die Datenbanktabellen \fBspooltab\fR (fÃ¼r gerade laufende Faxe), \fBouta\fR (fÃ¼r gesandte und gescheiterte Faxe) und \fBinca\fR (fÃ¼r angekommene Faxe) werden Ã¼berprÃ¼ft und ggf. erstellt oder erweitert.
.LP
11) Im Fall der entsprechenden Kommandozeilenoptionen werden Korrekturen bei Dateien im Warteverzeichnis oder den Protokolltabellen durchgefÃ¼hrt oder deren Inhalt aufgelistet und das Programm dann beendet.
.LP
12) Andernfalls werden Dateien im \fBZufaxenverzeichnis\fR analysiert. Jede Datei, deren im Dateinamen enthaltene Faxnummer(n) ermittelbar ist/sind und die in eine PDF-Datei umwandelbar ist (oder schon so vorliegt), wird ins Warteverzeichnis verschoben und in \fBspooltab\fR eingetragen.
.br
Falls eine Datei mehrere Faxnummern enthÃ¤lt und/oder eine PDF-Umwandlung nÃ¶tig ist, werden zusÃ¤tzliche Dateien erstellt und die ursprÃ¼ngliche Datei ggf. umbenannt.
Falls nÃ¶tig, kÃ¶nnen die Dateien zusÃ¤tzliche Zifferm nahe ihrem Namensende bekommen, so dass die Namen mit keinem anderen der unter 7) genannten Verzeichnisse in Konflikt steht.
.br
Falls neue Dateien erstellt wurden, werden die nachfolgenden Verschiebungen und Protokollierungen mit allen durchgefÃ¼hrt.
.\" DateienHerricht(), WVZinDatenbank()
.LP
13) Je nach Konfiguration wird die FunktionsfÃ¤higkeit von \fBhylafax\fR und/oder \fBcapisuite\fR Ã¼berprÃ¼ft und ggf. nach MÃ¶glichkeit hergestellt (falls nÃ¶tig und mÃ¶glich auch mit Installation dieser Programme; fÃ¼r eine Fritzcard 2.0 sowie fÃ¼r ein Faxmodem USR5637 kann/wird auch eine automatische Konfiguration erfolgen). Kernelmodule fÃ¼r hylafax bzw. capisuite werden fÃ¼r die aktuelle Kernelversion erstellt, auch bei etwaigen Kernelupdates.
.LP
14) Im Fall entsprechender Kommandozeilenoptionen werden Faxe gelÃ¶scht und das Programm dann beendet.
.LP
15) Andernfalls werden die unter 12) in \fBspooltab\fR eingetragenen Dateien an \fBhylafax\fR oder \fBcapisuite\fR weitergeleitet und dies in \fBspooltab\fR protokolliert.
.\" faxealle()
.LP
16) Alle in \fBspooltab\fR als wartend stehenden Faxe werden in \fBhylafax\fR/\fBcapisuite\fR auf ihren Status Ã¼berprÃ¼ft, dieser wird in \fBspooltab\fR aktualisiert (Zahl der bisherigen Faxversuche).
.br
Falls sowohl hylafax als auch capisuite aktiv sind und eine voreingestellte Zahl an Anwahlversuchen im Programm der ersten PrÃ¤ferenz dieser beiden erfolglos erreicht ist, wird das Fax auch noch an das jeweils andere Programm weitergeleiet.
.br
Falls der Faxvorgang (erfolgreich oder erfolglos) beendet ist, wird die Datei aus dem Warteverzeichnis in die Verzeichnisse fÃ¼r fertige bzw. gescheiterte Faxe verschoben, optional mit ocrmypdf einer Texterkennung unterzogen (falls ein ausreichend junges Python3 > 3.5 installiert ist), und der Datenbankeintrag aus \fBspooltab\fR in die Tabelle \fBouta\fR verschoben.
.br
Der Status der genannten Faxe wird angezeigt.
.\" untersuchespool()
.LP
17) Weitere in der Warteschleife von hylafax/capisuite befindliche, nicht Ã¼ber Â²DPROGÂ² erstellte Faxe werden ggf. angezeigt.
In Intervallen werden sie in die Â²DPROGÂ²-Datenbank integriert (ohne die fehlende Information Ã¼ber den ursprÃ¼nglichen Dateinamen)
.LP
18) Ãœber \fBhylafax\fR/\fBcapisuite\fR empfangene Faxe werden ggf. mit Hilfe der Faxnummer anhand voreingestellter SQL-Befehle nach dem Namen des Absenders benannt und in ein Empfangsverzeichnis gestellt.
.br
Solche SQL-Befehle sollen (mindestens) zwei Ergebnisfelder (mit benutzerdefinierter Bedeutung) liefern, deren Inhalt dann, durch ein Komma getrennt, von Â²DPROGÂ² zur Benennung eines empfangenen Faxes verwendet werden. Vor der Anwendung des SQL-Befehls wird die Zeichenfolge '&&faxnr&&' zur aktuellen Faxnummer erweitert. Beispiel fuer einen solchen SQL-Befehl:
.br
.br
\fIselect concat(haname,', ',ort,', ',kvnu) name, zulg from kvaerzte.hae where concat(if(mid(fax1k,1,1)='0','','08131'), replace(replace(replace(replace(fax1k,' ',''),'-',''),'/',''),'\'','')) = '&&faxnr&&'\fR
.br
.br
Wenn mehrere SQL-Befehle angegeben werden, so wird der jeweils naechste angewandt, wenn einer kein Ergebnis liefert.
.br
Optional werden die empfangenen Dateien mit Hilfe von ocrmypdf einer Texterkennung unterzogen.
.LP
19) Die Konfigurationsdatei \fBÂ²DPROGÂ².conf\fR wird ggf. geschrieben.
.LP
Einige Programmteile laufen parallel, dies kann sich die Reihenfolge der Ergebnisanzeige auflockern. 
.br
Senden und Empfangen wiederholen sich ggf. minÃ¼tlich, bis der jeweils andere Teil zum ersten Mal fertig ist.
.br
ÃœberprÃ¼fung und ggf. Korrektur evtl. falsch abgelegter Dateien (z.B. infolge eines willkÃ¼rlichen Programmabbruchs von auÃŸen) werden in AbstÃ¤nden durchgefÃ¼hrt.

.SH VORAUSSETZUNGEN
\fBHardware\fR: Computer mit einer Fritzcard 2.0 oder 2.1 und/oder einem linux-kompatiblen Modem; in der vorliegenden Fassung wird fÃ¼r eine automatische Installation des Programms (unter Beantwortung einiger RÃ¼ckfragen) ein US Robotics Modem USR5637 und eine der untenstehenden Linuxversionen benÃ¶tigt.
Im Fall der Verwendung von Fritzcard plus einem Modem kann das Programm beide Faxwege alternativ nutzen, um die Ãœbertragungssicherheit zu erhÃ¶hen. 
.br
\fBSoftware\fR: Das Programm wurde auf eine Installation von Opensuse >= 42.1, Debian >= 8.60, Ubuntu >= 16.04, Mint >= 18 oder Fedora >= 24 mit jeweils Standardoptionen abgestimmt. System D muss installiert sein bzw. systemctl muss laufen, was in den genannten Programmversionen der Fall ist. Jeweils einer der Paketmanager rpm oder dpkg sowie apt, dnf, yum oder zypper muss installiert sein, wie in den genannten Linuxdistributionen standardmÃ¤ÃŸig der Fall. Die Deinstallation der durch Â²DPROGÂ² hinzugefÃ¼gten Programme mit \fBmake uninstall\fR ist gegenwÃ¤rtig nur fÃ¼r englische und deutsche Versionen der Paketmanager eingerichtet.
.br
.\"In Manjaro kÃ¶nnen vor Installation noch die Befehle: 'sudo pacman -S wget vi' und 'sudo pacman -Syu' nÃ¶tigt werden.
.SH AUTOMATISCH INSTALLIERTE PROGRAMMPAKETE
.br
(hierzu wird je nach Distribution zypper, apt(-get), dnf oder yum verwendet).
.LP
\fI\fBmakefile:\fR
.br
gcc V.6, g++ V.6, groff, libmysqlclient-dev(el), libtiff-dev(el) (im Fall von Vers. 4.0.7 mit leichter Modifikation, s. Makefile)
.LP
\fI\fBÂ²DPROGÂ²:\fR
.br
boost, boost-devel, cron, ghostscript, imagemagick, libreoffice-common, libreoffice-base, mariadb-server, policycoreutils, policycoreutils-python-utils, poppler-tools, samba, sfftobmp, (in debian-derivates, fÃ¼r mariadb, zusÃ¤tzlich: apt-transport-https)
.LP
\fIfalls \fBcapisuite\fR \fIbenutzt werden soll\fR:
.br
capisuite, capiutils, capi4linux, fcpci-3.10.0, gcc-4.8, g++-4.8, kernel-source (linux-source), libcapi20-2, libcapi20-3, libxslt-tools, linux-headers-$(uname -r), python-devel, (in fedora, zusÃ¤tzlich: kernel-modules-extra), 
.LP
\fIfalls \fBhylafax\fR \fIbenutzt werden soll\fR:
.br
hylafax+, hylafax+-client, sendmail, tiff (im Fall von Vers. 4.0.7 mit kleiner Modifikation, s. Makefile)
.LP
\fIfalls \fBocr\fR \fIbenutzt werden soll\fR:
.br
ffmpeg, ffmpeg-devel, ffmpeg-compat, gcc, libavformat-devel, libffi-devel, ocrmypdf, python3-devel, python3-pip, python3-setuptools, rpmfusion, qpdf, redhat-rpm-config, tesseract-ocr, unpaper, and via 'python3 pip': cryptography, cffi, image, M2Crypto, ocrmypdf, PyPDF2, reportlab, ruffus.
.LP
\fIfalls Sie die Quelldateien mit 'sh viall' bearbeiten wollen\fR:
.br
vim
.LP
All diese Installationen kÃ¶nnen abhÃ¤ngige Programme einschlieÃŸen.
.br
Falls Sie eines dieser Programme nicht wollen bzw. nicht aktualisieren wollen, dann dÃ¼rfen Sie Â²DPROGÂ² oder die entsprechenden Programmteile nicht auf diesem Computer verwenden.

.SH AUSWIRKUNGEN DES PROGRAMMABLAUFS
Das Programm muss zum ordentlichen Funktionieren folgende MaÃŸnahmen ergreifen:
.LP
1) In Debian kann in der Datei /etc/apt/sources.list ein DVD-Eintrag hinter die Standard-Online-Repositories verschoben werden.
.br
2) Sudo (fehlt anfangs bei Standardinstallation in Debian) wird ggf. installiert. 
.br
Der Benutzer beim Installationsvorgang wird, falls nicht schon enthalten, in eine Administrator-Gruppe eingetragen, die in /etc/sudoers genannt wird, da er "sudo" ausfÃ¼hren muÃŸ.
.LP
3) 'GNU make' wird, falls nicht vorhanden, durch Aufruf von 'sh ./install.sh' bzw. 'configure' automatisch installiert.
.LP
4) Installieren von \fBHylafax+\fR, falls ein Modem angeschlossen ist und Hylafax+ nicht installiert ist. Ggf. Konfiguration von Hylafax+ durch Aufruf von '\fBfaxsetup -nointeracitve\fR', durch Editieren der Konfigurationsdateien \fBconfig\fR und \fBconfig.*\fR (z.B. \fBconfig.ttyACM0\fR) im hylafax-Konfigurationsverzeichnis (Vorgabe z.B.: \fB/var/spool/hylafax/etc/\fR)
.LP
5) Installieren von \fBcapisuite\fR, falls eine Fritzkarte eingebaut ist und capisuite nicht installiert ist.
Ggf. Bearbeitung der Konfigurationsdateien \fB/etc/capisuite/capisuite.conf\fR und \fB/etc/capisuite/fax.conf\fR.
Ggf. Bearbeitung des Python-Scripts fÃ¼r ankommende Faxe (Vorgabe z.B.: \fB/usr/lib64/capisuite/incoming.py\fR) zur Bestimmung der Zahl der KlingeltÃ¶ne 
bis zur Faxannahme, Erstellung bzw. Bearbeitung der Dateien 
'\fB/etc/udev/rules.d/46-FKN_isdn_capi.rules\fR', '\fB/etc/modprobe.d/50-blacklist.conf\fR'.
.LP
6) Einrichten von Diensten: 
.br
a) in systemd (im Verzeichnis /usr/lib/systemd/system oder /lib/systemd/system), insbesondere:
.br
\fBhylafax-faxq.service\fR, \fBhylafax-hfaxd.service\fR, \fBhylafax-faxgetty-....service\fR (z.B. \fBhylafax-faxgetty-ttyACM0\fR),
.br
capisuite.service,
.br
b) Verschieben von Diensten aus dem Verzeichnis /etc/init.d in ein neu eingerichtes Verzeichnis /etc/ausrangiert:
\fBhylafax\fR, \fBcapisuite\fR
.br
c) falls \fBselinux\fR aktiv ist (wie standardmÃ¤ÃŸig in fedora), dann behindert es standardmÃ¤ÃŸig \fBhylafax\fR; in diesem Fall wird im Hintergrund ein Modul fÃ¼r selinux eingerichtet, um den Betrieb von hylafax-hfaxd wieder zu erlauben. Ferner muss (bis zur eventuellen Erstellung einer maÃŸgeschneiderteren LÃ¶sung) die DomÃ¤ne 'getty' mit dem Befehl '\fBsemanage permissive -a getty_t\fR' in selinux entschÃ¤rft werden, um faxe Ã¼ber hylafax empfangen zu kÃ¶nnen.
.LP
7) Erstellen einer Protokolldatei, standardmÃ¤ÃŸig \fB/var/log/Â²DPROGÂ².log\fR.
.LP
8) ggf. Erstellen und Zugreifbarmachen der bestimmbaren \fBVerzeichnisse\fR fÃ¼r zu sendende, wartende, abgearbeitete und empfangene Faxe.
.LP
9) ggf. Erstellen und VerÃ¤ndern der Konfigurationsdatei Â²DPROGÂ².conf in dem Verzeichnis, in dem auch es selbst steht (Vorgabe: /usr/local/sbin/Â²DPROGÂ²).
.LP
10) ggf. EinfÃ¼gen einer Zeile zum automatischen periodischen Aufruf des Programms in das crontab (von root)
.LP
11) ggf. EinfÃ¼gen von Abschnitten fÃ¼r die unter 8) genannten Verzeichnisse in /etc/samba/smb.conf, ggf. EinfÃ¼gen/Passwortzuteilen des Programmbenutzers bzw. (falls root) des fÃ¼r die Capisuite gewÃ¤hlten Benutzers als Samba-Benutzer.
Falls Suse-Firewall vorhanden, samba-Server fuer "externe Zone" eintragen.
Nach Programmaufruf sollten die unter 8) genannten Verzeichnisse im Samba-Netzwerk sichtbar sein und Dateien im Verzeichnis fÃ¼r zu sendende Faxe erstellt werden kÃ¶nnen.
.LP
12) ggf. EinfÃ¼gen einer Datenbank fÃ¼r die Faxe in mariadb unter einem bestimmbaren Namen, Anlage und VerÃ¤nderung mehrerer Tabellen und einer Prozedur in dieser Datenbank, ggf. EinfÃ¼gen eines Benutzers mit bestimmbarem Namen in mariadb zur Datenpflege in diesen Tabellen 
.LP
13) durch entsprechende Befehlszeilenoptionen von Â²DPROGÂ² kÃ¶nnen innerhalb von hylafax und capisuite Faxe gelÃ¶scht werden, insbesondere:
.br
a) in hylafax: durch Aufruf von 'faxrm'
.br
b) in capisuite: durch LÃ¶schen der Dateien wie /var/spool/capisuite/users/<user>/sendq/*.txt und ~/*.sff.
In capisuite kann auch eine verwaiste Lock-Datei (/var/spool/capisuite/users/<user>/sendq/*.lock) gelÃ¶scht werden.
.LP
14) mit einer Befehlszeilenoption kann ein frÃ¼her empfangenes Fax erneut in eine pdf-Datei umgewandelt werden.
.br
.SH DEINSTALLATION
Wechseln Sie in einem Terminal in das Installationsverzeichnis (beim selben eingeloggten Benutzer: \fBcd ~/Â²DPROGÂ²\fR, ansonsten wird es Ã¼ber \fBÂ²DPROGÂ² -info\fR angezeigt).
.br
Rufen Sie dort \fBmake uninstall\fR auf.
.br
Dadurch wird das installierte \fBÂ²DPROGÂ²\fR gelÃ¶scht und das Script \fBuninstallinv\fR in umgekehrter Reihenfolge abgearbeitet, das bei der Installation und beim Aufruf von Â²DPROGÂ² erstellt wurde. 
.br
Dadurch werden zusÃ¤tzlich installierte Programmpakete, zusÃ¤tzlich erteilte Berechtigungen, fÃ¼r Â²DPROGÂ² eingerichtete Sambafreigaben und Firewallausnahmen wieder gelÃ¶scht. 
.br
Auf die Deinstallation der Konfigurationsdateien, der angesammelten Daten und systemrelevanter Programme wie libgcc und selinux wird dabei verzichtet.
.br
Etwaige Fehlermeldungen beziehen sich meist auf einen Deinstallationsversuch bereits entfernter Programme und kÃ¶nnen ignoriert werden.
.br
.SH FEHLER
Fehler bitte mit u.a. dem Wort 'Â²DPROGÂ²' in der Email-Ueberschrift melden. 
.br
Bitte auch melden, wenn sich Ã„nderungsbedarf durch andere Hard- bzw. Software ergeben.
.br
.SH PROGRAMMÃ„NDERUNG
Durch Aufruf von '\fBsh viall\fR' mit den Ã¼blichen '\fBvim\fR'-Befehlen, gefolgt von '\fBmake\fR' und '\fBmake install\fR' vom Installationsverzeichnis ('\fB~/Â²DPROGÂ²\fR) aus kÃ¶nnen Sie das Programm Ã¤ndern.

.SH HAFTUNG
Das Programm wurde mit bester Absicht entwickelt und durch den Autor getestet.
.br
Trotzdem kann der Autor fÃ¼r keine SchÃ¤den haften, die durch das Programm entstehen kÃ¶nnten

.SH AUTOR
Gerald Schade (geraldschade@gmx.de; www.diabdachau.de)
